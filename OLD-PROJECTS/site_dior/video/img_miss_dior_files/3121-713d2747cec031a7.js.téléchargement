"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3121],{80119:function(e,n,r){r.d(n,{o:function(){return M},Z:function(){return q}});var t=r(94776),o=r.n(t),i=r(9323),u=r(55731),a=r(52921),c=r(15939),s=r(9079),l=r(72800),d=r(49766),v=r(50407),f=r(90193),b=r(5632),m=r(2784),p=r(94078),w=r(1500),O=r(32137),g=r(89710),k=r(65040),E=r(33481);function h(){var e,n,r=(e=["\n  ","\n\n  query GetProductsForBambuser($id: String!) {\n    product: getProduct(id: $id) {\n      sku\n      code\n      title\n      description\n      price {\n        ...Price\n      }\n      medias {\n        image {\n          mobile {\n            uri\n          }\n        }\n        sku\n      }\n      variations {\n        sku\n        title\n        price {\n          ...Price\n        }\n      }\n      reviews {\n        averageScore: averageOverallRating\n        reviewsSize: totalReviewCount\n        maxRating: overallRatingRange\n      }\n      crossSells {\n        sku\n        title\n        attributes {\n          image {\n            mobile {\n              uri\n            }\n          }\n          price {\n            value\n          }\n        }\n      }\n    }\n  }\n"],n||(n=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(n)}})));return h=function(){return r},r}var y=(0,k.gql)(h(),E.Z);function _(e,n,r,t,o,i,u){try{var a=e[i](u),c=a.value}catch(s){return void r(s)}a.done?n(c):Promise.resolve(c).then(t,o)}var x=function(){var e,n=(e=o().mark((function e(n,r){var t,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=3;break}throw new Error(O.VU.INVALID_PRODUCT_CODE);case 3:return e.next=5,(0,g.WQ)({locale:r}).query({query:y,variables:{id:n},context:{headers:{"x-dior-universe":c.AW,"x-dior-locale":r},credentials:"include"}});case 5:return i=e.sent,e.abrupt("return",null===i||void 0===i||null===(t=i.data)||void 0===t?void 0:t.product);case 7:case"end":return e.stop()}}),e)})),function(){var n=this,r=arguments;return new Promise((function(t,o){var i=e.apply(n,r);function u(e){_(i,t,o,u,a,"next",e)}function a(e){_(i,t,o,u,a,"throw",e)}u(void 0)}))});return function(e,r){return n.apply(this,arguments)}}(),T=function(e){return"string"===typeof e},C=r(88369),P=r(91593),S=r(61456);function A(e,n,r,t,o,i,u){try{var a=e[i](u),c=a.value}catch(s){return void r(s)}a.done?n(c):Promise.resolve(c).then(t,o)}function R(e){return function(){var n=this,r=arguments;return new Promise((function(t,o){var i=e.apply(n,r);function u(e){A(i,t,o,u,a,"next",e)}function a(e){A(i,t,o,u,a,"throw",e)}u(void 0)}))}}function I(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function N(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{},t=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),t.forEach((function(n){I(e,n,r[n])}))}return e}var j=a.n.AVAILABLE,B=w.Z.BAMBUSER_ONE_TO_ONE_ORG_ID,L=w.Z.ENABLED_BAMBUSER_ONE_TO_ONE_WIDGET_LOCALES,M=5,q=function(e){var n=e.withWidget,r=(0,m.useContext)(v.j),t=r.isCurrentUniverseEcommerce,a=r.locale,w=r.universe,O=(0,p.v9)(i.Om).isFetched,g=(0,p.v9)(i.W3).errorMessage,k=(0,p.I0)(),E=(0,m.useCallback)((function(e){return k((0,u._7)({sku:e,universe:c.ce}))}),[k]),h=(0,m.useCallback)((function(e){return k((0,u.B8)(e,c.ce))}),[k]),y=(0,m.useCallback)((function(){return k((0,C.LA)())}),[k]),_=(0,m.useCallback)((function(e,n){return k((0,u.Ol)(e,c.ce,n))}),[k]),A=(0,b.useRouter)(),I=(0,d.y)("bambuser_productNotFoundMessage","bambuser_tryAgainErrorMessage","bambuser_variationLabel","errorMissingOrInvalidField"),q=I.bambuser_productNotFoundMessage,D=I.bambuser_tryAgainErrorMessage,U=I.bambuser_variationLabel,V=I.errorMissingOrInvalidField,F=(0,m.useState)(!1),Z=F[0],z=F[1],W=(0,m.useState)(!1),G=W[0],Q=W[1],$=(0,m.useCallback)((function(e){e&&(window.oneToOneEmbed.data=N({},window.oneToOneEmbed.data,e)),window.oneToOneEmbed.show()}),[]),J=(0,m.useCallback)((function(e){window.oneToOneCartRefresh&&window.oneToOneCartRefresh(e)}),[]),Y=(0,m.useCallback)(function(){var e=R(o().mark((function e(n,r){var i,u,l,d;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d={},e.prev=2,n){e.next=7;break}i=V,e.next=16;break;case 7:return e.next=9,x(n,a);case 9:if(u=e.sent,l=(null===u||void 0===u?void 0:u.variations.map((function(e){return e.sku})))||[],(null===u||void 0===u?void 0:u.sku)||(i=q),!(null===l||void 0===l?void 0:l.length)||!t){e.next=16;break}return e.next=15,(0,P.m)(a,l).toPromise();case 15:d=e.sent;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(2),i=D;case 21:window.oneToOneEmbed.updateProduct(r,(function(e){if(i)throw new Error(i);var n=(0,s._T)({locale:a,universe:c.ce,codeOrSku:u.sku}),r=l.indexOf(u.sku);return e.currency(u.price.currency).locale(a).product((function(e){return e.name(u.title).sku(u.sku).defaultVariationIndex(r).description(u.description).url("".concat(window.location.origin).concat(n)).attributes((function(e){return[e(U).options((function(e){return u.variations.map((function(n){return e(n.title||u.title).name(n.title||u.title)}))}))]})).variations((function(e){return u.variations.filter((function(e){return!!e})).map((function(n){var r,t=null===u||void 0===u?void 0:u.medias.filter((function(e){return(null===e||void 0===e?void 0:e.sku)===n.sku})).map((function(e){var n;return null===(n=e.image)||void 0===n?void 0:n.mobile.uri})),o=!d||(null===(r=d[n.sku])||void 0===r?void 0:r.status)===j,i=n.title||u.title,a=e().name(u.title).subtitle(i).sku(n.sku).inStock(o).imageUrls(t).price((function(e){return e.current(n.price.value)})).attributes((function(e){return[e(U,i)]})).relatedProducts((function(e){return u.crossSells?u.crossSells.map((function(n){var r,t;return e().title(n.title).sku(n.sku).imageUrl((null===(r=n.attributes)||void 0===r||null===(t=r.image)||void 0===t?void 0:t.mobile.uri)||"").price((function(e){var r,t;return e.current(null===(r=n.attributes)||void 0===r||null===(t=r.price)||void 0===t?void 0:t.value)}))})):[]}));return u.reviews&&a.rating((function(e){var n,r,t;return e.maxValue(null===u||void 0===u||null===(n=u.reviews)||void 0===n?void 0:n.maxRating).rating(null===u||void 0===u||null===(r=u.reviews)||void 0===r?void 0:r.averageScore).numberOfRatings(null===u||void 0===u||null===(t=u.reviews)||void 0===t?void 0:t.reviewsSize)})),a}))}))}))}));case 22:case"end":return e.stop()}}),e,null,[[2,18]])})));return function(n,r){return e.apply(this,arguments)}}(),[a,t,q,U,D,V]),H=!(0,f.isEmpty)(B)&&JSON.parse(B)[a],K=(0,m.useCallback)(R(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,window.onBambuserOneToOneReady=function(e){if(!H)return!1;var r={triggers:["smart","connect-link"],smartVariantOverride:"Avatar",popupTimeoutSeconds:M.toString()};window.oneToOneEmbed=new e(N({orgId:H,locale:a,floatingPlayer:{confirmClosingBrowser:!0,navigationMode:e.FLOATING_PLAYER_NAVIGATION_MODE.MANUAL}},n&&r)),window.oneToOneEmbed.on("provide-product-data",(function(e){T(e)||null===e||void 0===e||e.products.forEach(function(){var e=R(o().mark((function e(n){var r,t,i,u,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n.ref,t=n.type,i=n.id,"url"===t?(a=r.match(/^.*beauty-([^-]*)-?_?.*/),u=a?a[1]:void 0):u=r,Y(u,i);case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}())})),window.oneToOneEmbed.on("should-add-item-to-cart",(function(e,n){e&&!T(e)&&(window.oneToOneCartRefresh=n,E(e.sku))})),window.oneToOneEmbed.on("should-update-item-in-cart",(function(e,n){e&&!T(e)&&(window.oneToOneCartRefresh=n,(null===e||void 0===e?void 0:e.quantity)>0&&_(e.sku,e.quantity),0===e.quantity&&h(e.sku))})),window.oneToOneEmbed.on("goto-checkout",(function(){window.oneToOneEmbed.floatAbove(),y()})),window.oneToOneEmbed.on("surf-behind-to",(function(e){T(e)&&A.push(e.replace(window.location.origin,""))}))},e.next=4,(0,l.V)("https://one-to-one.bambuser.com/embed.js","bambuser-one-to-one");case 4:z(!0),n&&Q(!0),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.error(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])}))),[E,a,Y,h,_,y,A,H,n]);return(0,m.useEffect)((function(){(!Z&&!n||!Z&&n&&L.includes(a)||Z&&n&&L.includes(a)&&!G)&&K()}),[Z,K,G,n,w,a]),(0,S.Z)(),(0,m.useEffect)((function(){O&&!g&&J(!0)}),[O,g,J]),(0,m.useEffect)((function(){g&&J({success:!1,reason:g})}),[g,J]),{openBambuserOneToOne:$,setIsWidgetScriptLoaded:Q}}},61456:function(e,n,r){var t=r(87801),o=r(50407),i=r(2784),u=r(80119);n.Z=function(e,n){var r=(0,i.useContext)(o.j).universe,a=function(){var e=document.getElementById("one-to-one-initiation");e&&e.remove();var n=document.getElementById("bambuser-one-to-one");n&&n.remove()};(0,i.useEffect)((function(){(0,t.Q)(r)&&!e||a()}),[r,e]),(0,i.useEffect)((function(){e&&n&&setTimeout(a,1e3*u.o)}))}},33481:function(e,n,r){var t=r(65040);function o(){var e,n,r=(e=["\n  fragment Price on Price {\n    value\n    currency\n  }\n"],n||(n=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(n)}})));return o=function(){return r},r}n.Z=(0,t.gql)(o())}}]);